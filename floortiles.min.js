/*
 FloorTiles v1.1 (https://github.com/tontsacom/floortiles)
 Copyright 2017
 Licensed under the MIT license
*/
(function(h){var m={tileSize:{x:200,y:150},tileLimit:{x:6,y:4},maxWidth:1E3,gap:3,minCol:2,maxCol:6,animate:!0,animateTime:500,delayResizeTime:500,tiled:function(a,d){}},k=function(a,d){this.$element=h(a);var c=this.$element.children();0==c.length&&h.error("\u041f\u043b\u0438\u0442\u043a\u0438 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442 in jQuery.floortiles");c.eq(0).data("tile")||h.error("\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d \u0440\u0430\u0437\u043c\u0435\u0440 \u043f\u043b\u0438\u0442\u043a\u0438 \u0432 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0435 0 in jQuery.floortiles");
for(var b=c.get(0).tagName,e=1;e<c.length;e++)c.eq(e).data("tile")||h.error("\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d \u0440\u0430\u0437\u043c\u0435\u0440 \u043f\u043b\u0438\u0442\u043a\u0438 \u0432 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0435 "+e+" in jQuery.floortiles"),c.get(e).tagName!=b&&h.error("\u041d\u0435 \u043e\u0434\u043d\u043e\u0440\u043e\u0434\u043d\u044b\u0439 \u043f\u043e \u0442\u0435\u0433\u0443 \u0441\u043e\u0441\u0442\u0430\u0432 \u043f\u043b\u0438\u0442\u043e\u043a in jQuery.floortiles");
c.css({position:"absolute"});this.$element.wrapInner('<div class="floortiles-wrapper" style="position: relative;max-width: 100%;margin: 0 auto;" />');this.tiles=[];this.spaces=[];this.holes=[];this.poses=[];h.extend(this,m);this.nextStatus=!1;this.reset(d);this.nextStatus=!0};k.prototype.destructor=function(){this.$element.html(this.$element.children().html());this.$element.children().removeAttr("style")};k.prototype.reset=function(a){for(var d in a)if(d in m)switch(d){case "tileSize":var c=this.minSize(a[d],
"40x30");c||h.error("Wrong value "+a[d]+" of property "+d+" in jQuery.floortiles");this[d]=c;break;case "tileLimit":(c=this.size(a[d]))||h.error("Wrong value "+a[d]+" of property "+d+" in jQuery.floortiles");this[d]=c;break;default:this[d]=a[d]}else h.error("Undefined property "+d+" in jQuery.floortiles");this.refresh()};k.prototype.refresh=function(){"number"==typeof this.maxWidth?this.width=Math.min(this.$element.width(),this.maxWidth):"none"==this.maxWidth?this.width=this.$element.width():h.error("Wrong value of property maxWidth in jQuery.floortiles");
this.columns=Math.max(Math.min(Math.ceil((this.width+this.gap)/this.tileSize.x),this.maxCol),this.minCol);for(var a=this.$element.find(".floortiles-wrapper"),d=a.children(),c=this.step(),b,e,f,g=this.tiles.length=0;g<d.length;g++)e=this.minSizeTile(d.eq(g).data("tile")),this.tiles.push({i:g,x:e.x,y:e.y});this.debug||(b=performance.now());this.sitAll();for(g=0;0<this.holes.length&&100>g;g++){for(f=1;f<this.tiles.length&&this.tiles[f].i!=this.holes[0].i;f++);for(;f--&&this.tiles[f].x==this.tiles[f+
1].x;);e=this.tiles[f+1];this.tiles[f+1]=this.tiles[f];this.tiles[f]=e;this.sitAll()}this.debug||(b=performance.now()-b,this.debug={iteration:g,time:b});for(g=0;g<this.tiles.length;g++)f=this.poses[g],b=this.boundSize(this.tiles[g]),e=this.boundSizeR(b),f={x:c.x*f.x,y:c.y*f.v},e={x:c.x*e.x-this.gap,y:c.y*e.v-this.gap},this.tiled(d.eq(this.tiles[g].i),{index:this.tiles[g].i,tile:b,pos:f,size:e,tileSize:this.tileSize}),this.animate&&this.nextStatus?d.eq(this.tiles[g].i).animate({width:e.x+"px",height:e.y+
"px",left:f.x+"px",top:f.y+"px"},this.animateTime):d.eq(this.tiles[g].i).css({width:e.x+"px",height:e.y+"px",left:f.x+"px",top:f.y+"px"});a.css({width:c.x*this.columns-this.gap+"px",height:c.y*this.maxSpacesV(0,this.columns)-this.gap+"px"})};k.prototype.sitAll=function(){this.holes.length=0;for(var a=this.spaces.length=0;a<this.columns;a++)this.spaces[a]={x:a,y:0,v:0,i:0};for(a=this.poses.length=0;a<this.tiles.length;a++)this.poses.push(this.sit(this.tiles[a]))};k.prototype.sit=function(a){var d=
this.boundSize(a);if(d.x>=this.columns){d=this.boundSizeR(d);var c={x:0,y:this.maxSpaces(0,this.spaces.length),v:this.maxSpacesV(0,this.spaces.length),i:a.i};for(var b=0;b<this.spaces.length;b++){for(var e=this.spaces[b].y;e<c.y;e++)this.holes.push({x:this.spaces[b].x,y:e,v:e-this.spaces[b].y+this.spaces[b].v,i:a.i});this.spaces[b]={x:b,y:c.y+d.y,v:c.v+d.v,i:a.i}}this.holes.sort(this.compareH);return c}for(var d=this.boundSizeR(d),f=[],b=0;b<this.spaces.length-d.x+1;b++)f[b]={x:b,y:this.maxSpaces(b,
b+d.x),v:this.maxSpacesV(b,b+d.x),i:a.i};f.sort(this.compareH);for(var g=[],b=0;b<this.holes.length;b++){c=this.holes[b];for(e=1;e<d.x&&(!(b+e>=this.holes.length||this.holes[b+e].x!=c.x+e||this.holes[b+e].y!=c.y)||!(this.holes[b].x+e>=this.spaces.length||this.spaces[this.holes[b].x+e].y>c.y));e++);e==d.x&&g.push(c)}var h=g.length;if(0<h&&1<d.y){g.sort(this.compareV);for(b=0;b<h-d.y+1;b++){c=g[b];for(e=1;e<d.y&&g[b+e].x==c.x&&g[b+e].y==c.y+e;e++);e==d.y&&g.push(c)}g.splice(0,h);g.sort(this.compareH)}if(0<
g.length&&0>this.compareH(g[0],f[0])){c=g[0];for(b=0;b<this.holes.length&&(this.holes[b].x!=c.x||this.holes[b].y!=c.y);b++);for(e=1;e<d.x&&b+e<this.holes.length&&this.holes[b+e].x==c.x+e&&this.holes[b+e].y==c.y;e++);for(this.holes.splice(b,e);e<d.x;e++){for(f=this.spaces[c.x+e].y;f<c.y;f++)this.holes.push({x:this.spaces[c.x+e].x,y:f,v:f,i:a.i});this.spaces[c.x+e]={x:this.spaces[c.x+e].x,y:c.y+d.y,v:c.v+d.v,i:a.i}}for(f=1;f<d.y;f++){for(;b<this.holes.length&&(this.holes[b].x!=c.x||this.holes[b].y!=
c.y+f);b++);for(e=1;e<d.x&&b+e<this.holes.length&&this.holes[b+e].x==c.x+e&&this.holes[b+e].y==c.y+f;e++);this.holes.splice(b,e)}this.holes.sort(this.compareH);return c}c=f[0];for(b=c.x;b<c.x+d.x;b++){for(e=this.spaces[b].y;e<c.y;e++)this.holes.push({x:this.spaces[b].x,y:e,v:e+this.spaces[b].v-this.spaces[b].y,i:a.i});this.spaces[b]={x:b,y:c.y+d.y,v:c.v+d.v,i:a.i}}this.holes.sort(this.compareH);f.length=0;return c};k.prototype.onSit=function(a,d){console.log(this);console.log(a);console.log(d)};k.prototype.step=
function(){var a=Math.min(Math.round((this.width+this.gap)/this.columns-this.gap),this.tileSize.x);return{x:a+this.gap,y:Math.round(a/this.tileSize.x*this.tileSize.y)+this.gap}};k.prototype.size=function(a){a=a.split("x");return 2!=a.length?!1:{x:parseInt(a[0]),y:parseInt(a[1])}};k.prototype.minSize=function(a,d){var c=this.size(a);if(!c)return!1;var b=this.size(d);return{x:Math.max(c.x,b.x),y:Math.max(c.y,b.y)}};k.prototype.minSizeTile=function(a){return(a=this.minSize(a,"1x1"))?a:{x:1,y:1}};k.prototype.boundSize=
function(a){return{x:Math.min(a.x,this.tileLimit.x),y:Math.min(a.y,this.tileLimit.y)}};k.prototype.boundSizeR=function(a){return a.x>this.columns?{x:this.columns,y:1,v:a.y/a.x*this.columns}:a.x==this.columns?{x:this.columns,y:1,v:a.y}:{x:a.x,y:a.y,v:a.y}};k.prototype.maxSpaces=function(a,d){for(var c=this.spaces[a].y,b=a+1;b<d;b++)c=Math.max(c,this.spaces[b].y);return c};k.prototype.maxSpacesV=function(a,d){for(var c=this.spaces[a].v,b=a+1;b<d;b++)c=Math.max(c,this.spaces[b].v);return c};k.prototype.compareH=
function(a,d){return a.y>d.y?1:a.y<d.y?-1:a.x>d.x?1:-1};k.prototype.compareV=function(a,d){return a.x>d.x?1:a.x<d.x?-1:a.y>d.y?1:-1};var l={init:function(a){return this.each(function(){var d=h(this),c=d.data("floortiles"),b;c?c.reset(a):(c=new k(this,a),h(window).on("resize.floortiles",function(){b&&clearTimeout(b);b=setTimeout(function(){c.refresh()},c.delayResizeTime)}));d.data("floortiles",c)})},refresh:function(){return this.each(function(){h(this).data("floortiles").refresh()})},destroy:function(){return this.each(function(){var a=
h(this),d=a.data("floortiles");h(window).off(".floortiles");d.destructor();a.removeData("floortiles")})}};h.fn.floortiles=function(a){if(l[a])return l[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof a&&a)h.error("\u041c\u0435\u0442\u043e\u0434 \u0441 \u0438\u043c\u0435\u043d\u0435\u043c "+a+" \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0434\u043b\u044f jQuery.floortiles");else return l.init.apply(this,arguments)}})(jQuery);